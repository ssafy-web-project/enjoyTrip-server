<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" 
    "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="com.ssafy.trip.model.mapper.SpotMapper">

    <resultMap type="Spot" id="searchSpotList">
        <result column="content_id" property="contentId"/>
        <result column="title" property="title"/>
        <result column="addr1" property="addr1"/>
        <result column="content_type_id" property="contentTypeId"/>
        <result column="first_image" property="firstImage"/>
        <result column="latitude" property="latitude"/>
        <result column="longitude" property="longitude"/>
    </resultMap>
    
    <resultMap type="Spot" id="getSpot">
        <result column="content_id" property="contentId"/>
        <result column="title" property="title"/>
        <result column="addr1" property="addr1"/>
        <result column="readcount" property="readCount"/>
        <result column="content_type_id" property="contentTypeId"/>
        <result column="first_image" property="firstImage"/>
        <result column="latitude" property="latitude"/>
        <result column="longitude" property="longitude"/>
    </resultMap>

    <resultMap type="Spot" id="getSpotDetail">
        <result column="content_id" property="contentId"/>
        <result column="title" property="title"/>
        <result column="tel" property="tel"/>
        <result column="addr1" property="addr1"/>
        <result column="content_type_id" property="contentTypeId"/>
        <result column="first_image" property="firstImage"/>
        <result column="latitude" property="latitude"/>
        <result column="longitude" property="longitude"/>
        <result column="overview" property="overview"/>
    </resultMap>
    
     <resultMap type="SidoDto" id="getSido">
        <result column="sido_id" property="sidoId"/>
        <result column="name" property="sidoName"/>
    </resultMap>
    
    <resultMap type="gugunDto" id="getGugun">
        <result column="gugun_id" property="gugunId"/>
        <result column="name" property="gugunName"/>
    </resultMap>
    
    <select id="getSidoList" resultMap="getSido">
        select sido_id, replace(sido_name, '\r', '') as name 
        from sido
    </select>
    
    <select id="getGugunList" parameterType="int" resultMap="getGugun">
        select gugun_id, replace(gugun_name, '\r', '') as name 
        from gugun
        where sido_id = #{sidoId}
    </select>
    
    <select id="getSpotList" parameterType="map" resultMap="getSpot">
        select content_id, title, addr1, readcount, content_type_id, first_image, latitude, longitude
        from spot
        where sido_id = #{sidoId} and gugun_id = #{gugunId}
    </select>
    
    <select id="getSpot" parameterType="int" resultMap="getSpotDetail">
        select s.content_id, s.title, s.tel, s.addr1, s.content_type_id, s.first_image, s.latitude, s.longitude, d.overview
        from spot s, description d
        where s.content_id = d.content_id and s.content_id = #{contentId}
    </select>
    
    <select id="searchSpot" parameterType="string" resultMap="searchSpotList">
        select content_id, title, addr1, content_type_id, first_image, latitude, longitude
        from spot
        where title like concat('%', #{keyword}, '%') and content_type_id != 25 and (longitude between 124 and 132) and (latitude between 33 and 43)
        order by readcount desc
    </select>
    
    <select id="getThemeTopSpot" parameterType="string" resultType="Spot">
        select s.content_id, s.title, s.tel, s.addr1, s.content_type_id, s.first_image, s.latitude, s.longitude, d.overview
        from spot s left join description d
        on s.content_id = d.content_id 
        where s.content_type_id = #{contentTypeId}
        order by readcount desc 
        limit 1
    </select>
</mapper>