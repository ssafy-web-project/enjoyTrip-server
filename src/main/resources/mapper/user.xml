<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" 
    "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
    
<mapper namespace="com.ssafy.trip.model.mapper.UserMapper">

    <resultMap type="User" id="getUserDetail">
        <result column="id" property="id"/>
        <result column="name" property="name"/>
        <result column="password" property="password"/>
        <result column="email" property="email"/>
        <result column="file_url" property="userProfileImage"/>
    </resultMap>
    
    <resultMap type="UserSearchResponseDto" id="getUserSearchResponseDto">
        <result column="id" property="id"/>
        <result column="name" property="name"/>
        <result column="password" property="password"/>
        <result column="email" property="email"/>
        <result column="file_url" property="userProfileImage"/>
    </resultMap>
    
	<select id="login" parameterType="user" resultType="user">
		select id, password, name, email
		from user 
		where id=#{id} and password=#{password}
	</select>
	
	<select id="SearchbyID" parameterType="string" resultMap="getUserDetail">
		select u.id, u.name, u.password, u.email, f.file_url
		from user u LEFT JOIN user_img_file f
		ON u.id = f.user_id
		where id = #{id}
	</select>
	
	<select id="profile" parameterType="string" resultType="user">
		select id, password, name, email
		from user 
		where name=#{name}
	</select>
	
	<select id="findPassword" parameterType="string" resultType="com.ssafy.trip.dto.User">
		select name, id, email
		from user 
		where id = #{userId}
	</select>
	
	<!-- 등록 -->
	<insert id="regist" parameterType="user">
		insert into user (id, password, name, email) values (#{id}, #{password}, #{name}, #{email})
	</insert>
	
	<!-- 삭제 -->
	<delete id="delete" parameterType="string">
		delete from user where id=#{id}
	</delete>
	
	<!-- 수정 -->
	<update id="update" parameterType="user">
		update user set password=#{password}, name=#{name} where id=#{id}
	</update>

	<!-- 수정 -->
	<update id="updateUser" parameterType="user">
		update user set email=#{email}, name=#{name} where id=#{id}
	</update>
	
	<!-- 수정 -->
	<update id="updatePassword" parameterType="user">
		update user set password=#{password} where id=#{id}
	</update>
	<!-- id 중복 체크  -->
	<select id="checkId" parameterType="string" resultType="int">
		select count(id) 
		from user 
        where id= #{id}
	</select>
	
		<!-- 친구 찾기 -->
	<select id="friendSearch" parameterType="hashMap" resultMap="getUserSearchResponseDto">
		select u.id, u.name, u.password, u.email, f.file_url
		from user u LEFT JOIN user_img_file f
		ON u.id = f.user_id
		where u.id like concat(#{searchWord}, '%')
	</select>

	<insert id="userImgFileInsert" parameterType="com.ssafy.trip.dto.user.UserImgFileDto">
		insert into user_img_file ( user_id, file_name, file_size, file_content_type, file_url, register_time )
		            values ( #{userId}, #{fileName}, #{fileSize}, #{fileContentType}, #{fileUrl}, now() )
	</insert>
	
	<delete id="userImgFileDelete" parameterType="String">
		delete from user_img_file where user_id = #{userId}
	</delete>
	
	<select id="userDetailFile" parameterType="String" resultType="com.ssafy.trip.dto.user.UserImgFileDto">
		select file_url
		from user_img_file
		where user_id = #{userId}
	</select>
</mapper>